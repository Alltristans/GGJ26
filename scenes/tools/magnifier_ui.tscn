[gd_scene load_steps=4 format=3 uid="uid://c7xdm6xfyafq"]

[sub_resource type="Shader" id="Shader_magnifier_lens"]
code = "shader_type canvas_item;
uniform sampler2D screen_texture : hint_screen_texture;

void fragment(){
	vec2 uv = UV;
	float dist = distance(uv, vec2(0.5));
	
	// Create circular lens with smooth edges
	if (dist > 0.5) {
		discard;
	}
	
	// Apply zoom to the magnified content
	COLOR = texture(TEXTURE, uv);
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_lens"]
shader = SubResource("Shader_magnifier_lens")

[sub_resource type="CanvasTexture" id="CanvasTexture_frame"]

[node name="MagnifierRoot" type="Control" groups=["magnifier_ui"]]
layout_mode = 3
anchors_preset = 0
offset_right = 220.0
offset_bottom = 220.0

[node name="LensFrame" type="Control" parent="."]
layout_mode = 1
anchors_preset = 0
offset_right = 220.0
offset_bottom = 220.0

[node name="LensView" type="TextureRect" parent="LensFrame"]
layout_mode = 1
anchors_preset = 0
offset_right = 220.0
offset_bottom = 220.0
material = SubResource("ShaderMaterial_lens")
expand_mode = 1
stretch_mode = 0

[node name="LensFrame2D" type="Control" parent="LensFrame"]
layout_mode = 1
anchors_preset = 0
offset_right = 220.0
offset_bottom = 220.0

[node name="FrameBorder" type="ColorRect" parent="LensFrame/LensFrame2D"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0.2, 0.15, 0.1, 1)

[node name="MagnifierViewport" type="SubViewport" parent="."]
size = Vector2i(220, 220)
render_target_update_mode = 4

[node name="MagnifierCamera" type="Camera2D" parent="MagnifierViewport"]
zoom = Vector2(0.5, 0.5)
