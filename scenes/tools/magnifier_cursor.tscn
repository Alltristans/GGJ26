[gd_scene format=3 uid="uid://dlx7wm8f2v7pj"]

[sub_resource type="Shader" id="Shader_magnifier_cursor"]
code = "shader_type canvas_item;

uniform sampler2D screen_texture : hint_screen_texture;
uniform float zoom_level : hint_range(0.5, 3.0) = 2.5;

void fragment() {
	vec2 uv = UV;
	float dist = distance(uv, vec2(0.5));
	
	// Circular lens
	if (dist > 0.5) {
		discard;  // Outside circle - transparent
	}
	
	// Sample from screen with zoom
	vec2 center = vec2(0.5);
	vec2 offset = (uv - center) / zoom_level;
	vec2 zoomed_uv = center + offset;
	
	COLOR = texture(screen_texture, zoomed_uv);
	
	// Add border effect
	float border = smoothstep(0.48, 0.52, dist);
	COLOR.rgb = mix(vec3(0.2, 0.15, 0.1), COLOR.rgb, border);
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_magnifier"]
shader = SubResource("Shader_magnifier_cursor")
shader_parameter/zoom_level = 2.5

[node name="MagnifierUI" type="Control"]
layout_mode = 3
anchors_preset = 0
offset_right = 120.0
offset_bottom = 120.0
mouse_filter = 2

[node name="MagnifierViewport" type="SubViewport" parent="."]
size = Vector2i(120, 120)
transparent_bg = true
render_target_update_mode = 4

[node name="MagnifierCamera" type="Camera2D" parent="MagnifierViewport"]
zoom = Vector2(0.4, 0.4)

[node name="MagnifierDisplay" type="TextureRect" parent="."]
layout_mode = 1
anchors_preset = 0
offset_right = 120.0
offset_bottom = 120.0
material = SubResource("ShaderMaterial_magnifier")
expand_mode = 1
stretch_mode = 0
